<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quadratic Level Generator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styling for a professional look */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f9;
        }
        /* Custom scrollbar for better look */
        .level-table-container::-webkit-scrollbar {
            width: 8px;
        }
        .level-table-container::-webkit-scrollbar-thumb {
            background-color: #9ca3af;
            border-radius: 4px;
        }
        .level-table-container::-webkit-scrollbar-track {
            background: #e5e7eb;
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">

    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="4xl font-extrabold text-indigo-700 mb-2">
                BTC Important Levels
            </h1>
            <p class="text-gray-600 text-lg">
                Calculate Proprietary Trading Levels based on the Quadratic Formula.
            </p>
        </header>

        <!-- Input Card -->
        <div class="bg-white p-6 rounded-xl shadow-2xl mb-8 border border-indigo-100">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Enter Base Price (Xâ‚€)</h2>
            <p class="text-sm text-gray-500 mb-4">
                Enter the Bitcoin or Bank Nifty Open Price to generate the levels.
            </p>
            <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4">
                <input
                    type="number"
                    id="basePriceInput"
                    placeholder="E.g., 114037.00"
                    value="114037.00"
                    step="0.000000001"
                    class="flex-grow p-3 border-2 border-indigo-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-150 text-lg"
                >
                <button
                    onclick="calculateLevels()"
                    class="bg-indigo-600 text-white p-3 rounded-lg font-semibold hover:bg-indigo-700 transition duration-200 shadow-md hover:shadow-lg transform hover:scale-[1.01] active:scale-[0.99] disabled:opacity-50"
                >
                    Calculate Levels
                </button>
            </div>
            <div id="error-message" class="mt-3 text-red-600 text-sm hidden"></div>
        </div>

        <!-- Output Card -->
        <div class="bg-white p-6 rounded-xl shadow-2xl border border-indigo-100">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Generated Levels</h2>
            
            <!-- Loading Indicator -->
            <div id="loading-indicator" class="text-center py-8 text-gray-500 text-lg">
                <div class="animate-spin inline-block w-6 h-6 border-4 border-indigo-500 border-t-transparent rounded-full mr-2"></div>
                Calculating levels...
            </div>

            <!-- Table Container with Scroll -->
            <div id="table-container" class="level-table-container overflow-x-auto max-h-[60vh] hidden">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-indigo-50 sticky top-0">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Level (n)
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Input B ($\sqrt{A_0} \pm n$)
                            </th>
                            <th class="px-6 py-3 text-right text-xs font-bold text-gray-700 uppercase tracking-wider">
                                Calculated Level A
                            </th>
                        </tr>
                    </thead>
                    <tbody id="levels-output" class="bg-white divide-y divide-gray-100">
                        <!-- Levels will be injected here by JavaScript -->
                    </tbody>
                </table>
            </div>
            <p id="formula-display" class="mt-4 text-sm text-gray-500 text-center"></p>
        </div>
    </div>

    <script>
        // Constants derived from the data analysis of the user's formula.
        const LEVEL_COUNT = 10; // Generate 10 levels above and 10 below
        
        // Per the user's explicit formula, there is no constant offset (C = 0).
        const CONSTANT_C = 0; 

        /**
         * Calculates the important level based on the derived two-step quadratic formula: Y = (sqrt(X0) + n)^2
         * @param {number} x0 - The base price (user input, X0).
         * @param {number} n - The level offset (+n for buy, -n for sell, 0 for open).
         * @returns {number} The calculated important level (Y).
         */
        function calculateLevel(x0, n) {
            // Step 1: Calculate the intermediate base value (B0 = sqrt(A0))
            const xInt = Math.sqrt(x0); 
            // Step 2: Calculate the final input value (Bn = B0 + n)
            const xInput = xInt + n; 
            // Step 3: Calculate the output level (An = Bn^2)
            return (xInput * xInput) + CONSTANT_C;
        }

        /**
         * The main function to calculate and display all levels.
         */
        function calculateLevels() {
            const inputElement = document.getElementById('basePriceInput');
            const outputElement = document.getElementById('levels-output');
            const errorElement = document.getElementById('error-message');
            const loadingIndicator = document.getElementById('loading-indicator');
            const tableContainer = document.getElementById('table-container');

            // Show loading indicator temporarily
            loadingIndicator.classList.remove('hidden');
            tableContainer.classList.add('hidden');
            outputElement.innerHTML = ''; // Clear previous results

            const basePrice = parseFloat(inputElement.value);

            // 1. Input Validation
            if (isNaN(basePrice) || basePrice <= 0) {
                errorElement.textContent = "Please enter a valid positive numerical price.";
                errorElement.classList.remove('hidden');
                document.getElementById('formula-display').textContent = '';
                loadingIndicator.classList.add('hidden'); // Hide loading indicator on error
                return;
            }
            errorElement.classList.add('hidden');

            // Display the formula used
            document.getElementById('formula-display').textContent = 
                `Formula Used: Level A = (\\sqrt{Base Price A_0} \\pm n)^2`;

            let levelsHtml = '';

            // 2. Calculate Levels BELOW (n = -10 to -1)
            for (let n = LEVEL_COUNT; n >= 1; n--) {
                const levelN = -n;
                const levelY = calculateLevel(basePrice, levelN);

                // Calculate the Intermediate Input B for display purposes
                const inputB = Math.sqrt(basePrice) + levelN;

                levelsHtml += generateRow(levelN, inputB, levelY, 'bg-red-50 hover:bg-red-100 text-red-700');
            }

            // 3. Display the Base Price Row (The Open Price itself)
            const openLevelY = calculateLevel(basePrice, 0);
            const openInputB = Math.sqrt(basePrice);

            levelsHtml += generateRow(
                'OPEN', 
                openInputB, 
                openLevelY, 
                'bg-indigo-100 hover:bg-indigo-200 font-bold text-indigo-800'
            );

            // 4. Calculate Levels ABOVE (n = 1 to 10)
            for (let n = 1; n <= LEVEL_COUNT; n++) {
                const levelN = n;
                const levelY = calculateLevel(basePrice, levelN);
                
                // Calculate the Intermediate Input B for display purposes
                const inputB = Math.sqrt(basePrice) + levelN;

                levelsHtml += generateRow(levelN, inputB, levelY, 'bg-green-50 hover:bg-green-100 text-green-700');
            }

            outputElement.innerHTML = levelsHtml;
            
            // Hide loading indicator and show table
            loadingIndicator.classList.add('hidden');
            tableContainer.classList.remove('hidden');
        }

        /**
         * Helper function to generate an HTML table row.
         */
        function generateRow(n, inputB, levelA, classes) {
            // Use 9 decimal places for B (Intermediate Input) to match the expected high-precision input for B.
            const formattedB = inputB.toFixed(9); 
            // Use 8 decimal places for A (Calculated Level) to display maximum high-precision consistency.
            const formattedA = levelA.toFixed(8);

            return `
                <tr class="${classes} transition duration-150">
                    <td class="px-6 py-3 whitespace-nowrap text-sm font-medium">${n}</td>
                    <td class="px-6 py-3 whitespace-nowrap text-sm font-mono">${formattedB}</td>
                    <td class="px-6 py-3 whitespace-nowrap text-sm text-right font-semibold">${formattedA}</td>
                </tr>
            `;
        }

        // Run calculation on window load
        window.onload = function() {
            calculateLevels();
        };

    </script>
</body>
</html>
